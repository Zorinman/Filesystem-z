
`访问网盘网页` → `用户注册` → `用户登录` → `HTTP 请求拦截器`→ 登录成功html在头像等位置调用`查询用户信息接口`来展示用户信息 

# 账户管理模块解析

## 模块概述
账户管理模块主要负责用户的注册、登录、用户信息查询等功能。通过该模块，用户可以完成账户的创建、登录验证以及相关信息的获取。模块基于 `Gin` 框架实现，提供了 RESTful 风格的接口。

---

## 功能解析

### 1. 用户注册
#### 接口说明
- **接口路径**: `/user/signup`
- **请求方法**: 
    - `GET`: 返回注册页面。
    - `POST`: 提交注册信息。

#### 代码解析
- **`SignupHandler`**: 
    - 处理 `GET` 请求，重定向到静态注册页面 `/static/view/signup.html`。
- **`DoSignupHandler`**:
    - 处理 `POST` 请求，接收用户名和密码。
    - 对密码进行加盐 (`pwd_salt`) 和 `SHA1` 加密。
    - 调用 `dblayer.UserSignup` 将用户信息存储到数据库。
    - 返回注册结果的 JSON 响应。

---

### 2. 用户登录
#### 接口说明
- **接口路径**: `/user/signin`
- **请求方法**: 
    - `GET`: 返回登录页面。
    - `POST`: 提交登录信息。

#### 代码解析
- **`SignInHandler`**:
    - 处理 `GET` 请求，重定向到静态登录页面 `/static/view/signin.html`。
- **`DoSignInHandler`**:
    - 处理 `POST` 请求，接收用户名和密码。
    - 对密码进行加盐 (`pwd_salt`) 和 `SHA1` 加密。
    - 调用 `dblayer.UserSignin` 验证用户名和密码。
    - 登录成功后生成访问凭证 (`token`)，并更新到数据库。
    - 返回包含用户信息和跳转地址的 JSON 响应。

---
### 3. HTTP 请求拦截器
#### 功能说明
- **功能**: 拦截所有需要验证的接口请求，校验用户的 `token` 是否有效。
- **实现方式**: 使用 `Gin` 框架的中间件功能。

#### 代码解析
- **`HTTPInterceptor`**:
    - 从请求中获取 `username` 和 `token` 参数。
    - 调用 `IsTokenValid` 验证 `token` 的有效性。
    - 如果验证失败，返回状态码和错误信息，并终止请求处理。
    - 验证通过后，继续执行后续的处理逻辑。



---
### 4. 查询用户信息
#### 接口说明
- **接口路径**: `/user/info`
- **请求方法**: `POST`

#### 代码解析
- **`UserInfoHandler`**:
    - 接收用户名参数。
    - 调用 `dblayer.GetUserInfo` 查询用户信息。
    - 返回用户信息的 JSON 响应。

---
### 5. 查询用户是否存在(未使用)
#### 接口说明
- **接口路径**: `/user/exists`
- **请求方法**: `POST`

#### 代码解析
- **`UserExistsHandler`**:
    - 接收用户名参数。
    - 调用 `dblayer.UserExist` 检查用户是否存在。
    - 返回用户存在状态的 JSON 响应。
---
## 工具函数解析

### 1. `GenToken`
- 功能: 生成用户登录的访问凭证 (`token`)。
- 实现: 
    - 使用 `MD5` 对 `username + timestamp + token_salt` 进行加密。
    - 拼接时间戳生成 40 位的 `token`。

### 2. `IsTokenValid`
- 功能: 验证 `token` 的有效性。
- 实现: 
    - 检查 `token` 长度是否为 40。
    - TODO: 验证 `token` 的时效性和数据库一致性。

---

## 总结
账户管理模块通过 `Gin` 框架实现了用户注册、登录、信息查询等功能，代码逻辑清晰，安全性通过加盐加密和 `token` 验证得到一定保障。未来可以进一步完善 `token` 的时效性验证和错误处理机制。  